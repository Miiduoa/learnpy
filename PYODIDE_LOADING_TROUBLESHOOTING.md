# Pyodide 載入問題排查指南

## 🔍 問題：一直顯示「正在載入 Python 執行環境...」

如果系統一直顯示「正在載入 Python 執行環境...」，請按照以下步驟排查：

---

## 📋 快速檢查清單

### 1. 檢查網絡連接
- ✅ 確認網絡連接正常
- ✅ 嘗試訪問其他網站確認網絡可用
- ✅ 檢查是否使用 VPN 或代理（可能需要切換節點）

### 2. 檢查瀏覽器控制台
1. 按 `F12` 打開開發者工具
2. 切換到「Console」（控制台）標籤
3. 查看是否有紅色錯誤訊息
4. 尋找包含 `[PYODIDE]` 或 `Pyodide` 的訊息

### 3. 檢查網絡請求
1. 在開發者工具中切換到「Network」（網絡）標籤
2. 刷新頁面
3. 查看是否有失敗的請求（紅色）
4. 特別注意 `pyodide.js` 相關的請求

---

## 🛠️ 解決方案

### 方案 1：刷新頁面
- 按 `F5` 或 `Ctrl+R` (Mac: `Cmd+R`) 刷新頁面
- 如果無效，嘗試強制刷新：`Ctrl+Shift+R` (Mac: `Cmd+Shift+R`)

### 方案 2：清除瀏覽器緩存
1. 按 `Ctrl+Shift+Delete` (Mac: `Cmd+Shift+Delete`)
2. 選擇「緩存的圖片和文件」
3. 點擊「清除數據」
4. 刷新頁面

### 方案 3：檢查防火牆/安全軟件
- 確認防火牆沒有阻止 CDN 訪問
- 暫時關閉安全軟件測試
- 檢查公司/學校網絡是否限制 CDN 訪問

### 方案 4：使用 VPN
如果您的網絡環境限制 CDN 訪問：
1. 連接 VPN
2. 刷新頁面
3. 等待 Pyodide 載入完成

### 方案 5：檢查瀏覽器擴展
某些瀏覽器擴展可能阻止外部腳本：
1. 嘗試使用無痕模式（`Ctrl+Shift+N` 或 `Cmd+Shift+N`）
2. 如果無痕模式可以載入，說明是擴展問題
3. 逐一禁用擴展找出問題擴展

### 方案 6：嘗試其他瀏覽器
- Chrome/Edge
- Firefox
- Safari

---

## 🔧 技術細節

### Pyodide 載入流程
1. **載入腳本**：從 CDN 載入 `pyodide.js`
   - 嘗試多個 CDN 來源（jsdelivr, unpkg）
   - 每個 CDN 有 25 秒超時
   
2. **初始化 Pyodide**：載入 Python 執行環境
   - 從 CDN 下載 Python 運行時（約 10-20 MB）
   - 初始化 Python 環境
   - 總超時時間：45 秒

### 可能的失敗原因
1. **網絡問題**
   - CDN 無法訪問
   - 網絡速度太慢
   - 防火牆阻止

2. **瀏覽器問題**
   - 擴展阻止腳本
   - 緩存損壞
   - 瀏覽器版本過舊

3. **系統問題**
   - 安全軟件阻止
   - 代理設置錯誤
   - DNS 解析問題

---

## 📊 診斷信息

### 在控制台查看載入狀態
打開瀏覽器控制台（F12），您應該看到類似以下的訊息：

```
[PYODIDE] 嘗試載入從 CDN 1/4: https://cdn.jsdelivr.net/pyodide/v0.24.1/full/pyodide.js
[PYODIDE] 已添加腳本標籤到 DOM: ...
[PYODIDE] 腳本標籤載入成功: ...
[PYODIDE] ✓ loadPyodide 函數已可用
[PYODIDE] 嘗試從 ... 初始化 Pyodide...
[PYODIDE] ✓ 成功從 ... 初始化
```

### 如果看到錯誤訊息
- `無法從 ... 載入腳本` → 網絡問題或 CDN 無法訪問
- `載入超時` → 網絡太慢或 CDN 無響應
- `loadPyodide 函數未定義` → 腳本載入不完整

---

## 🆘 如果所有方案都無效

### 檢查系統要求
- ✅ 現代瀏覽器（Chrome 90+, Firefox 88+, Safari 14+, Edge 90+）
- ✅ 穩定的網絡連接（建議至少 1 Mbps）
- ✅ 足夠的內存（Pyodide 需要約 100-200 MB）

### 聯繫支持
如果問題持續，請提供以下信息：
1. 瀏覽器類型和版本
2. 操作系統
3. 控制台的錯誤訊息（截圖）
4. 網絡標籤中的失敗請求（截圖）

---

## 💡 預防措施

### 優化載入體驗
1. **首次載入較慢**：Pyodide 首次載入需要下載約 10-20 MB，請耐心等待
2. **後續載入較快**：瀏覽器會緩存，後續載入會快很多
3. **網絡環境**：建議在穩定的網絡環境下使用

### 建議設置
- 使用穩定的網絡連接
- 避免在網絡不穩定時使用
- 首次使用時請耐心等待載入完成

---

## 📝 更新日誌

### 已改進的功能
- ✅ 多個 CDN 備用源（4 個不同的 CDN）
- ✅ 更詳細的錯誤訊息
- ✅ 自動重試機制
- ✅ 載入進度顯示
- ✅ 重試按鈕

### 未來計劃
- 本地 Pyodide 備選方案
- 更智能的 CDN 選擇
- 離線模式支持

---

## ✅ 快速測試

在瀏覽器控制台（F12）中執行以下代碼，測試網絡連接：

```javascript
// 測試 CDN 連接
fetch('https://cdn.jsdelivr.net/pyodide/v0.24.1/full/pyodide.js', { method: 'HEAD' })
  .then(() => console.log('✓ CDN 可訪問'))
  .catch(() => console.error('✗ CDN 無法訪問'));
```

如果顯示「✗ CDN 無法訪問」，說明網絡環境無法訪問 CDN，需要使用 VPN 或切換網絡。




